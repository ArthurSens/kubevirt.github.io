<!doctype html>
<html lang="en">

  <head>
    <!-- Adding Adobe Analytics -->
    <script id="dpal" src="//www.redhat.com/ma/dpal.js" type="text/javascript"></script>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width initial-scale=1, shrink-to-fit=no" >
    <meta name="go-import" content="kubevirt.io/kubevirt git https://github.com/kubevirt/kubevirt">
    <meta name="go-import" content="kubevirt.io/client-go git https://github.com/kubevirt/client-go">
    <meta name="go-import" content="kubevirt.io/containerized-data-importer git https://github.com/kubevirt/containerized-data-importer">
    <meta name="go-import" content="kubevirt.io/qe-tools git https://github.com/kubevirt/qe-tools">
    <meta name="go-import" content="kubevirt.io/machine-remediation git https://github.com/kubevirt/machine-remediation">
    <meta name="go-import" content="kubevirt.io/cloud-provider-kubevirt git https://github.com/kubevirt/cloud-provider-kubevirt">
    <link rel="apple-touch-icon" sizes="72x72" href="/assets/favicon/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon/favicon-16x16.png">
    <link rel="manifest" href="/assets/favicon/site.webmanifest">
    <link rel="mask-icon" href="/assets/favicon/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#00aba9">
    <meta name="theme-color" content="#ffffff">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/css/bootstrap.min.css" integrity="sha384-9gVQ4dYFwwWSjIDZnLEWnxCjeSWFphJiwGPXr1jddIhOegiu1FwO5qRGvFXOdJZ4" crossorigin="anonymous">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="canonical" href="https://kubevirt.io//2018/attaching-to-multiple-networks.html">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700" rel="stylesheet">
    
    <title>Attaching To Multiple Networks | KubeVirt.io</title>
    <!-- # Opengraph protocol properties: https://ogp.me/ -->
    <meta name="author" content="yuvalif" >
    <meta property="og:type" content="article" >
    <meta name="twitter:card" content="summary">
    <meta name="description" content="This post describes how to connect a Virtual Machine to more than one network using the Multus CNI.">
    <meta name="keywords" content="news" >
    <meta property="og:title" content="Attaching To Multiple Networks | KubeVirt.io">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://kubevirt.io//2018/attaching-to-multiple-networks.html" >
    <meta property="og:image" content="https://kubevirt.io//assets/images/KubeVirt_logo_color.png">
    <meta property="og:description" content="This post describes how to connect a Virtual Machine to more than one network using the Multus CNI." >
    <meta property="og:site_name" content="KubeVirt.io" >
    <meta property="og:article:author" content="yuvalif" >
    <meta property="og:article:published_time" content="2018-09-12 00:00:00 +0000" >
    <meta name="twitter:title" content="Attaching To Multiple Networks | KubeVirt.io">
    <meta name="twitter:description" content="This post describes how to connect a Virtual Machine to more than one network using the Multus CNI.">

    <link type="application/atom+xml" rel="alternate" href="https://kubevirt.io//feed.xml" title="KubeVirt.io" />
</head>


  <body>
    <nav class="navbar navbar-expand-lg navbar-dark fixed-top" role="navigation">
        <a class="navbar-brand" href="/">
    <img src="/assets/images/KubeVirt_logo_color.svg" class="navbar-brand-image d-inline-block align-top" alt="KubeVirt.io">
  </a>
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
    <i class="fas fa-th-large"></i>
  </button>
  <div class="collapse navbar-collapse" id="navbarSupportedContent">
    <ul class="navbar-nav">
      

      
        <li  class="nav-item active" >
          <a class="nav-link text-uppercase" href="/blogs/">Blogs</a>
        </li>
      
        <li  class="nav-item" >
          <a class="nav-link text-uppercase" href="/videos/">Videos</a>
        </li>
      
        <li  class="nav-item" >
          <a class="nav-link text-uppercase" href="//kubevirt.io/user-guide">Docs</a>
        </li>
      
        <li  class="nav-item" >
          <a class="nav-link text-uppercase" href="/labs/">Labs</a>
        </li>
      
        <li  class="nav-item" >
          <a class="nav-link text-uppercase" href="/community/">Community</a>
        </li>
      

    </ul>
  </div>

    </nav>

    <main role="main" style="margin-top: 60px;">
      <div class="container">
  <div class="row">
    <div class="col">
      <div class="post">
        <header class="post-header">
          <h1></h1>
          <h1 class="post-title">Attaching To Multiple Networks</h1>
          <div class="post-info">
            <span class="post-author">Author: yuvalif</span>
            <div>
              <span class="post-meta">Publication Date: September 12, 2018  </span>
            </div>
            <div>
              <span class="post-category-name">
                Category: news
              </span>
            </div>
          </div>
        </header>
        <article class="post-content">
          <h1 id="introduction">Introduction</h1>
<p>Virtual Machines often need multiple interfaces connected to different networks. This could be because the application running on it expect to be connected to different interfaces (e.g. a virtual router running on the VM); because the VM need L2 connectivity to a network not managed by Kubernetes (e.g. allow for PXE booting); because an <strong>existing</strong> VM, ported into KubeVirt, runs applications that expect multiple interfaces to exists; or any other reason - which we’ll be happy to hear about in the comment section!</p>

<p>In KubeVirt, as nicely explained in this <a href="/2018/KubeVirt-Network-Deep-Dive.html">blog post</a>, there is already a mechanism to take an interface from the pod and move it into the Virtual Machine. However, Kubernetes allows for a single network plugin to be used in a cluster (across all pods), and provide one interface for each pod. This forces us to choose between having pod network connectivity and any other network connectivity for the pod and, in the context of KubeVirt, the Virtual Machine within.</p>

<p>To overcome this limitation, we use <a href="https://github.com/intel/multus-cni">Multus</a>, which is a “meta” CNI (Container Network Interface), allowing multiple CNIs to coexist, and allow for a pod to use the right ones for its networking needs.</p>

<h1 id="how-does-it-work-for-pods">How Does it Work for Pods?</h1>
<p>The magic is done via a new CRD (Custom Resource Definition) called <code class="highlighter-rouge">NetworkAttachmentDefinition</code> introduced by the Multus project, and adopted by the Kubernetes community as the <a href="https://docs.google.com/document/d/1Ny03h6IDVy_e_vmElOqR7UdTPAG_RNydhVE1Kx54kFQ/edit#heading=h.hylsbqoj5fxd">de-facto standard</a> for attaching pods to one or more networks. These network definition contains a field called <code class="highlighter-rouge">type</code> which indicates the name of the actual CNI that provide the network, and different configuration payloads which the Multus CNI is passing to the actual CNI. For example, the following network definition:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s2">"</span><span class="s">k8s.cni.cncf.io/v1"</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">NetworkAttachmentDefinition</span>
<span class="na">metadata</span><span class="pi">:</span>
 <span class="s"> name</span><span class="pi">:</span> <span class="s">a-bridge-network</span>
<span class="na">spec</span><span class="pi">:</span>
 <span class="s"> config</span><span class="pi">:</span> <span class="s1">'</span><span class="s">{</span>
 <span class="s">   "cniVersion":</span><span class="nv"> </span><span class="s">"0.3.0",</span>
 <span class="s">   "name":</span><span class="nv"> </span><span class="s">"a-bridge-network",</span>
 <span class="s">   "type":</span><span class="nv"> </span><span class="s">"bridge",</span>
 <span class="s">   "bridge":</span><span class="nv"> </span><span class="s">"br0",</span>
 <span class="s">   "isGateway":</span><span class="nv"> </span><span class="s">true,</span>
 <span class="s">   "ipam":</span><span class="nv"> </span><span class="s">{</span>
 <span class="s">     "type":</span><span class="nv"> </span><span class="s">"host-local",</span>
 <span class="s">     "subnet":</span><span class="nv"> </span><span class="s">"192.168.5.0/24",</span>
 <span class="s">     "dataDir":</span><span class="nv"> </span><span class="s">"/mnt/cluster-ipam"</span>
 <span class="s">   }</span>
<span class="s">}'</span>
</code></pre></div></div>

<p>Allows attaching a pod into a network provided by the <a href="https://github.com/containernetworking/plugins/tree/master/plugins/main/bridge">bridge CNI</a>.</p>

<p>Once a pod with the following annotation is created:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">samplepod</span>
  <span class="na">annotations</span><span class="pi">:</span>
    <span class="s">k8s.v1.cni.cncf.io/networks</span><span class="pi">:</span> <span class="s">a-bridge-network</span>
<span class="na">spec</span><span class="pi">:</span>
<span class="nn">...</span>
</code></pre></div></div>

<p>The Multus CNI will find out whether a CNI of type <code class="highlighter-rouge">bridge</code> exists, and invoke it with the rest of the configuration in the CRD.</p>

<p>Note that, even without Multus, this exact configuration could have been put under <code class="highlighter-rouge">/etc/cni/net.d</code>, and provide the same network to the pod, using the bride CNI. But, in such a case, this would have been the <strong>only</strong> network interface to the pod, since Kubernetes just takes the first configuration file from that directory (sorted by alphabetical order) and use it to provide a single interface for all pods.
If we have Multus around, and some other CNI (e.g. flannel), in addition to the bridge one, we could have have defined another <code class="highlighter-rouge">NetworkAttachmentDefinition</code> object, of type <code class="highlighter-rouge">flannel</code>, with its configuration, for example:</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s2">"</span><span class="s">k8s.cni.cncf.io/v1"</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">NetworkAttachmentDefinition</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">flannel-network</span>
<span class="na">spec</span><span class="pi">:</span> 
  <span class="na">config</span><span class="pi">:</span> <span class="s1">'</span><span class="s">{</span>
    <span class="s">"cniVersion":</span><span class="nv"> </span><span class="s">"0.3.0",</span>
    <span class="s">"type":</span><span class="nv"> </span><span class="s">"flannel",</span>
    <span class="s">"delegate":</span><span class="nv"> </span><span class="s">{</span>
      <span class="s">"isDefaultGateway":</span><span class="nv"> </span><span class="s">true</span>
    <span class="s">}</span>
  <span class="s">}'</span>
</code></pre></div></div>

<p>Add a reference to it in the pod’s annotation, and have two interfaces, connected to two different networks on the pod.</p>

<p>It is quite common that basic networking is provided by one of the mainstream CNIs (flannel, calico, weave etc.) for all pods, and more advanced cases are added specifically when needed. For that, a default CNI could be configured for Multus, so that a <code class="highlighter-rouge">NetworkAttachmentDefinition</code> object is not needed, nor any annotation at pod level. The interface provided for such a network wil be marked as <code class="highlighter-rouge">eth0</code> on the pod, for smooth transition when Multus is introduced into an cluster with networking. Any other interface added to the pod due to an explicit <code class="highlighter-rouge">NetworkAttachmentDefinition</code> object, will be marked as: <code class="highlighter-rouge">net1</code>, <code class="highlighter-rouge">net2</code> and so on.</p>

<h1 id="how-does-it-work-in-kubevirt">How Does it Work in KubeVirt?</h1>
<p>Most initial steps would be the same as in the pod’s case:</p>
<ul>
  <li>Install the different CNIs that you would like to provide networks to our Virtual Machines</li>
  <li>Install Multus</li>
  <li>Configure Multus with some default CNI that we would like to provide <code class="highlighter-rouge">eth0</code> for all Virtual Machines</li>
  <li>Add <code class="highlighter-rouge">NetworkAttachmentDefinition</code> object for each network that we would like some of our Virtual Machines to be using
Now, inside the VMI (virtual Machine Instance) definition, a new type of <code class="highlighter-rouge">network</code> called <code class="highlighter-rouge">multus</code> should be added:</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="na">networks</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">default-net</span>
<span class="s">￼     pod</span><span class="pi">:</span> <span class="pi">{}</span>
<span class="s">￼   - name</span><span class="pi">:</span> <span class="s">another-net</span>
<span class="s">￼     multus</span><span class="pi">:</span>
<span class="s">￼       networkName</span><span class="pi">:</span> <span class="s">a-bridge-network</span>
</code></pre></div></div>

<p>This would allow VMI interfaces to be connected to two networks:</p>
<ul>
  <li>
    <p><code class="highlighter-rouge">default</code> which is connected to the CNI which is defined as the default one for Multus. No <code class="highlighter-rouge">NetworkAttachmentDefinition</code> CRD is needed for this one, and we assume that the needed configuration is just taken from the default CNI’s configuration under <code class="highlighter-rouge">/etc/cni/net.d/</code>. We also assume that an IP address will be provided to <code class="highlighter-rouge">eth0</code> on the pod, which will be delegated to the Virtual Machine’s <code class="highlighter-rouge">eth0</code> interface.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">another-net</code> which is connected to the network defined by a <code class="highlighter-rouge">NetworkAttachmentDefinition</code> CRD named <code class="highlighter-rouge">a-bridge-network</code>. The identity fo the CNI that would actually provide the network, as well as the configuration for this network are all defined in the CRD. An interface named <code class="highlighter-rouge">net1</code> connected to that network wil be created on the pod. If this interface get an IP address from the CNI, this IP will be delegated to the Virtual Machine’s <code class="highlighter-rouge">eth1</code> interface. If no IP address is given by the CNI, no IP will be given to <code class="highlighter-rouge">eth1</code> on the Virtual Machine, and only L2 connectivity will be provided.</p>
  </li>
</ul>

<h1 id="deployment-example">Deployment Example</h1>
<p>In the following example we use flannel as the CNI that provides the primary pod network, and an <a href="https://github.com/kubevirt/ovs-cni">OVS bridge CNI</a> provides a secondary network.</p>

<h2 id="install-kubernetes">Install Kubernetes</h2>
<ul>
  <li>This was tested with latest version, on a single node cluster. Best would be to just follow <a href="https://kubernetes.io/docs/setup/independent/create-cluster-kubeadm/">these instructions</a></li>
  <li>Since we use a single node cluster, Don’t forget to allow scheduling pods on the master:</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl taint nodes <span class="nt">--all</span> node-role.kubernetes.io/master-
</code></pre></div></div>

<ul>
  <li>If running <code class="highlighter-rouge">kubectl</code> from master itself, don’t forget to copy over the conf file:</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">mkdir</span> <span class="nt">-p</span> /<span class="nv">$USER</span>/.kube <span class="o">&amp;&amp;</span> <span class="nb">cp</span> /etc/kubernetes/admin.conf /<span class="nv">$USER</span>/.kube/config
</code></pre></div></div>
<h2 id="install-flannel">Install Flannel</h2>
<ul>
  <li>Make sure pass these parameters are used  when starting <code class="highlighter-rouge">kubeadm</code>:</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nv">$ </span>kubeadm init <span class="nt">--pod-network-cidr</span><span class="o">=</span>10.244.0.0/16
</code></pre></div></div>

<ul>
  <li>Then call:</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nv">$ </span>kubectl apply <span class="nt">-f</span> https://raw.githubusercontent.com/coreos/flannel/v0.10.0/Documentation/kube-flannel.yml
</code></pre></div></div>

<h2 id="install-and-start-ovs">Install and Start OVS</h2>
<ul>
  <li>On Fedora28 that would be (see <a href="http://docs.openvswitch.org/en/latest/intro/install/general/">here</a> for other options):</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="nv">$ </span>dnf <span class="nb">install </span>openvswitch
 <span class="nv">$ </span>systemctl start openvswitch
</code></pre></div></div>

<h2 id="install-and-configure-multus">Install and Configure Multus</h2>
<ul>
  <li>Install Multus as a daemon set (flannel is already set as the default CNI in the yaml below):</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl apply <span class="nt">-f</span> https://raw.githubusercontent.com/intel/multus-cni/master/images/multus-daemonset.yml
</code></pre></div></div>

<ul>
  <li>Make sure that Multus is the first CNI under: <code class="highlighter-rouge">/etc/cni/net.d/</code>. If not, rename it so it would be the first, e.g.: <code class="highlighter-rouge">mv /etc/cni/net.d/70-multus.conf /etc/cni/net.d/00-multus.conf</code></li>
</ul>

<h2 id="install-and-configure-ovs-cni">Install and Configure OVS CNI</h2>
<ul>
  <li>First step would be to create the OVS bridge:</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ovs-vsctl add-br blue
</code></pre></div></div>

<ul>
  <li>To install the OVS CNI use:</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>kubectl apply <span class="nt">-f</span> https://raw.githubusercontent.com/kubevirt/ovs-cni/master/examples/ovs-cni.yml
</code></pre></div></div>

<ul>
  <li>Create a <code class="highlighter-rouge">NetworkAttachmentDefinition</code> CRD for the “blue” bridge:</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s2">"</span><span class="s">k8s.cni.cncf.io/v1"</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">NetworkAttachmentDefinition</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">ovs-blue</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">config</span><span class="pi">:</span> <span class="s1">'</span><span class="s">{</span>
      <span class="s">"cniVersion":</span><span class="nv"> </span><span class="s">"0.3.1",</span>
      <span class="s">"type":</span><span class="nv"> </span><span class="s">"ovs",</span>
      <span class="s">"bridge":</span><span class="nv"> </span><span class="s">"blue"</span>
    <span class="s">}'</span>
</code></pre></div></div>

<ul>
  <li>To use as specific port/vlan from that bridge, you should first create one:</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ovs-vsctl add-br blue1 blue 100
</code></pre></div></div>

<ul>
  <li>Then, define its <code class="highlighter-rouge">NetworkAttachmentDefinition</code> CRD:</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s2">"</span><span class="s">k8s.cni.cncf.io/v1"</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">NetworkAttachmentDefinition</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">ovs-blue100</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">config</span><span class="pi">:</span> <span class="s1">'</span><span class="s">{</span>
      <span class="s">"cniVersion":</span><span class="nv"> </span><span class="s">"0.3.1",</span>
      <span class="s">"type":</span><span class="nv"> </span><span class="s">"ovs",</span>
      <span class="s">"bridge":</span><span class="nv"> </span><span class="s">"blue100",</span>
      <span class="s">"vlan":</span><span class="nv"> </span><span class="s">100</span>
    <span class="s">}'</span>
</code></pre></div></div>

<ul>
  <li>More information could be found in the <a href="https://github.com/kubevirt/ovs-cni/blob/master/docs/deployment-on-arbitrary-cluster.md">OVS CNI documentation</a></li>
</ul>

<h2 id="deploy-a-virtual-machine-with-2-interfaces">Deploy a Virtual Machine with 2 Interfaces</h2>
<ul>
  <li>First step would be to deploy KubeVirt (note that 0.8 is needed for Multus support):</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span><span class="nb">export </span><span class="nv">VERSION</span><span class="o">=</span>v0.8.0
<span class="nv">$ </span>kubectl create <span class="nt">-f</span> https://github.com/kubevirt/kubevirt/releases/download/<span class="nv">$VERSION</span>/kubevirt.yaml
</code></pre></div></div>

<ul>
  <li>Now, create a VMI with 2 interfaces, one connected to the default network (flannel in our case) and one to the OVS “blue” bridge:</li>
</ul>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">kubevirt.io/v1alpha2</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">VirtualMachineInstance</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">creationTimestamp</span><span class="pi">:</span> <span class="no">null</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">special</span><span class="pi">:</span> <span class="s">vmi-multus-multiple-net</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">vmi-multus-multiple-net</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">domain</span><span class="pi">:</span>
    <span class="na">devices</span><span class="pi">:</span>
      <span class="na">disks</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">disk</span><span class="pi">:</span>
          <span class="na">bus</span><span class="pi">:</span> <span class="s">virtio</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">registrydisk</span>
        <span class="na">volumeName</span><span class="pi">:</span> <span class="s">registryvolume</span>
      <span class="pi">-</span> <span class="na">disk</span><span class="pi">:</span>
          <span class="na">bus</span><span class="pi">:</span> <span class="s">virtio</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">cloudinitdisk</span>
        <span class="na">volumeName</span><span class="pi">:</span> <span class="s">cloudinitvolume</span>
      <span class="na">interfaces</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">bridge</span><span class="pi">:</span> <span class="pi">{}</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">default</span>
      <span class="pi">-</span> <span class="na">bridge</span><span class="pi">:</span> <span class="pi">{}</span>
        <span class="na">name</span><span class="pi">:</span> <span class="s">ovs-blue-net</span>
    <span class="na">machine</span><span class="pi">:</span>
      <span class="na">type</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
    <span class="na">resources</span><span class="pi">:</span>
      <span class="na">requests</span><span class="pi">:</span>
        <span class="na">memory</span><span class="pi">:</span> <span class="s">1024M</span>
  <span class="na">networks</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">default</span>
    <span class="na">pod</span><span class="pi">:</span> <span class="pi">{}</span>
  <span class="pi">-</span> <span class="na">multus</span><span class="pi">:</span>
      <span class="na">networkName</span><span class="pi">:</span> <span class="s">ovs-blue</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">ovs-blue-net</span>
  <span class="na">terminationGracePeriodSeconds</span><span class="pi">:</span> <span class="m">0</span>
  <span class="na">volumes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">registryvolume</span>
    <span class="na">registryDisk</span><span class="pi">:</span>
      <span class="na">image</span><span class="pi">:</span> <span class="s">kubevirt/fedora-cloud-registry-disk-demo</span>
  <span class="pi">-</span> <span class="na">cloudInitNoCloud</span><span class="pi">:</span>
      <span class="na">userData</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="s">#!/bin/bash</span>
        <span class="s">echo "fedora" | passwd fedora --stdin</span>
    <span class="na">name</span><span class="pi">:</span> <span class="s">cloudinitvolume</span>
<span class="na">status</span><span class="pi">:</span> <span class="pi">{}</span>
</code></pre></div></div>

<ul>
  <li>Once the machine is up and running, you can use <code class="highlighter-rouge">virtctl</code> to log into it and make sure that <code class="highlighter-rouge">eth0</code> exists as the default interface (with an IP address on the flannel subnet) and <code class="highlighter-rouge">eth1</code> as the interface connected to the OVS bridge (without an IP)</li>
</ul>

        </article>

        

<a class="twitter-share-button" href="https://twitter.com/intent/tweet?text=Attaching To Multiple Networks&url=https://www.kubevirt.io/2018/attaching-to-multiple-networks.html&screen_name=kubevirt" aria-label="Share this on Twitter">
  <i class="fab fa-twitter mr-1"></i> Tweet
</a>
<hr/>


        
          <div id="disqus_thread"></div>
          <script>

          /**
          *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
          *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/

          var disqus_config = function () {
          this.page.url = post.url;  // Replace PAGE_URL with your page's canonical URL variable
          this.page.identifier = post.title; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
          };

          (function() { // DON'T EDIT BELOW THIS LINE
          var d = document, s = d.createElement('script');
          s.src = 'https://kubevirt-io.disqus.com/embed.js';
          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
          })();
          </script>
          <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        

      </div>
    </div>
  </div>
</div>

    </main>

    <footer class="footer" role="footer">
      <div class="container-fluid">
  <div class="row justify-content-center">
    <div class="col-sm-12 col-md-5">
      <p class="privacy-statement text-sm-left" style="text-align: center;">
        &copy; <script type="text/javascript"> document.write(new Date().getFullYear()); </script> KubeVirt | <a href="/privacy" class="privacy-statement-link">Privacy Statement</a>
      </p>
    </div>
    <div class="col-sm-12 col-md-5" style="text-align: center;">
      <p class="text-md-right">
        <a href="https://twitter.com/kubevirt" aria-label="Visit us on Twitter" class="link-social-twitter">
          <i class="fab fa-twitter fa-lg"></i>
        </a>
        <a href="https://github.com/kubevirt" aria-label="View our repo on GitHub" class="link-social-github">
          <i class="fab fa-github fa-lg"></i>
        </a>
        <a href="https://groups.google.com/forum/#!forum/kubevirt-dev" aria-label="Send us an email" class="link-social-mail">
          <i class="fas fa-envelope fa-lg"></i>
        </a>
        <a href="https://calendar.google.com/calendar/embed?src=18pc0jur01k8f2cccvn5j04j1g%40group.calendar.google.com&ctz=Etc%2FGMT"
            aria-label="See our calendar"
            class="link-social-calendar">
          <i class="fas fa-calendar fa-lg"></i>
        </a>
      </p>
    </div>
  </div>
  <div class="row">
    <div class="col offset-md-1 text-sm-left footer-licensing" style="text-align: center;">
      Code licensed under <a href="https://github.com/kubevirt/kubevirt/blob/master/LICENSE">Apache 2.0</a>,
      site under <a href="https://github.com/kubevirt/kubevirt.github.io/blob/master/LICENSE">MIT</a>.
    </div>
  </div>
</div>

    </footer>

    <script defer src="https://use.fontawesome.com/releases/v5.1.0/js/all.js" integrity="sha384-3LK/3kTpDE/Pkp8gTNp2gR/2gOiwQ6QaO7Td0zV76UFJVhqLl4Vl3KL1We6q6wR9" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js" integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.0/js/bootstrap.min.js" integrity="sha384-uefMccjFJAIv6A+rW+L4AHf99KvxDjWSu1z9VI8SKNVmz4sk7buKt/6v9KI65qnm" crossorigin="anonymous"></script>
    <script id="dsq-count-scr" src="//kubevirt-io.disqus.com/count.js" async></script>
    <script src="/js/kubevirt-io.js"></script>

    <!-- This comes from DTM/DPAL and must be latest entry in body-->

    <script type="text/javascript">
        if (("undefined" !== typeof _satellite) && ("function" === typeof _satellite.pageBottom)) {
            _satellite.pageBottom();
        }
    </script>
  </body>
</html>
